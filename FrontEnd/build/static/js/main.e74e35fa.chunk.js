(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{40:function(t,e,n){t.exports=n(83)},45:function(t,e,n){},46:function(t,e,n){},79:function(t,e,n){},80:function(t,e,n){},83:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),r=n(12),s=n.n(r),l=(n(45),n(5)),i=n(6),c=n(8),u=n(7),d=n(9),p=(n(46),n(17)),g=n(14),h=n(11),m=n.n(h),f=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(c.a)(this,Object(u.a)(e).call(this,t))).handleChange=function(t){n.setState({username:t.target.value,error:""})},n.handleSubmit=function(t){t.preventDefault(),""===n.state.username?n.setState({error:"Please enter username"}):0==n.state.lng||0==n.state.lat?n.setState({error:"Allow Geolocation and try again."}):(m.a.get("http://localhost:3000/user/"+n.state.username).then((function(t){0===(t.data.length||[]).length?m.a.post("http://localhost:3000/user/add/",{username:n.state.username,longitude:n.state.lng,latitude:n.state.lat,status:"1"}).then((function(t){if("Insert successful"==t.data&&(window.location="/map",console.log("success")),"Insert failed"==t.data)throw"Username already exists"})).catch((function(t){console.log(t),n.setState({error:"Database connection failed"})})):m.a.post("http://localhost:3000/user/update/",{username:n.state.username,longitude:n.state.lng,latitude:n.state.lat,status:"1"}).then((function(t){if("Update successful"==t.data&&(window.location="/map",console.log("success")),"Update failed"==t.data)throw"Update failed"})).catch((function(t){console.log(t),n.setState({error:"Database connection failed"})}))})),localStorage.setItem("user",n.state.username),localStorage.setItem("lat",n.state.lng),localStorage.setItem("lng",n.state.lat))},n.state={lng:0,lat:0,username:"",error:""},n}return Object(d.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){var t=this;0!=this.state.lng&&0!=this.state.lat||navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(e){t.setState({lat:e.coords.latitude,lng:e.coords.longitude})}))}},{key:"render",value:function(){return o.a.createElement("div",{className:"base"},o.a.createElement("h1",{className:"head"},"Log In"),o.a.createElement("form",{className:"form"},o.a.createElement("p",{className:"head"},"Enter username to continue"),o.a.createElement("input",{className:"input",value:this.state.username,type:"text",name:"name",onChange:this.handleChange}),""===this.state.error?null:o.a.createElement("div",{className:"error"},this.state.error),o.a.createElement("button",{className:"button",type:"submit",onClick:this.handleSubmit}," Login")))}}]),e}(o.a.Component),L=n(19),v=n(37),b=n.n(v),E=(n(66),n(18)),C={position:"absolute",width:"100%",height:"90%"},O=function(t){function e(t){var n;Object(l.a)(this,e);var a=(n=Object(c.a)(this,Object(u.a)(e).call(this,t))).props.panLat,o=n.props.panLng;return n.state={currentLocation:{lat:a,lng:o}},n}return Object(d.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.props.centerAroundCurrentLocation&&navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(e){var n=e.coords;t.setState({currentLocation:{lat:n.latitude,lng:n.longitude}})})),this.loadMap()}},{key:"componentDidUpdate",value:function(t,e){t.google!==this.props.google&&this.loadMap(),e.currentLocation!==this.state.currentLocation&&this.recenterMap(),t.panLat===this.props.panLat&&t.panLng===this.props.panLng||this.recenterMap(),t.users!=this.props.users&&this.renderChildren()}},{key:"loadMap",value:function(){if(this.props&&this.props.google){var t=this.props.google.maps,e=this.refs.map,n=s.a.findDOMNode(e),a=this.props.zoom,o=this.state.currentLocation,r=new t.LatLng(o.lat,o.lng),l=Object.assign({},{center:r,zoom:a});this.map=new t.Map(n,l)}}},{key:"recenterMap",value:function(){var t=this.map,e=(this.state.currentLocation,this.props.google.maps);if(t){var n=new e.LatLng(this.props.panLat,this.props.panLng);t.panTo(n)}}},{key:"renderChildren",value:function(){var t=this,e=this.props.children;if(e)return o.a.Children.map(e,(function(e){if(e)return o.a.cloneElement(e,{map:t.map,google:t.props.google,mapCenter:t.state.currentLocation})}))}},{key:"render",value:function(){var t=Object.assign({},C);return o.a.createElement("div",null,o.a.createElement("div",{style:t,ref:"map"},"Loading map..."),this.renderChildren())}}]),e}(o.a.Component),S=O;O.defaultProps={zoom:14,initialCenter:{lat:48.305862,lng:14.286444},centerAroundCurrentLocation:!0,visible:!0};var k={icon:"IconOnline.png"},w={icon:"IconOffline.png"},y=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(c.a)(this,Object(u.a)(e).call(this,t))).state={showingInfoWindow:!1,activeMarker:{},selectedPlace:{}},n.onMarkerClick=function(t,e,a){n.setState({selectedPlace:t,activeMarker:e,showingInfoWindow:!0})},n.onClose=function(t){n.state.showingInfoWindow&&n.setState({showingInfoWindow:!1,activeMarker:null})},n.displayMarkers=function(){return n.props.users.map((function(t,e){return 1==t.status?o.a.createElement(E.Marker,{onClick:n.onMarkerClick,key:e,icon:k.icon,name:t.username,status:t.status,position:{lat:t.latitude,lng:t.longitude}}):o.a.createElement(E.Marker,{onClick:n.onMarkerClick,key:e,icon:w.icon,name:t.username,status:t.status,position:{lat:t.latitude,lng:t.longitude}})}))},n.displayStatus=function(){return 1==n.state.selectedPlace.status?"Online":"Offline"},n.displayLocation=function(){if(n.state.selectedPlace.position)return o.a.createElement("div",null,o.a.createElement("h6",null,"Location"),o.a.createElement("p",null,"Latitude: ",n.state.selectedPlace.position.lat),o.a.createElement("p",null,"Longitude: ",n.state.selectedPlace.position.lng))},n}return Object(d.a)(e,t),Object(i.a)(e,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},"//PanLat and PanLng are passed down to the location component",o.a.createElement(S,{centerAroundCurrentLocation:!0,panLat:this.props.panLat,panLng:this.props.panLng,users:this.props.users,google:this.props.google},this.displayMarkers(),console.log(k),o.a.createElement(E.InfoWindow,{marker:this.state.activeMarker,visible:this.state.showingInfoWindow,onClose:this.onClose},o.a.createElement("div",null,o.a.createElement("h5",null,this.state.selectedPlace.name),this.displayLocation(),o.a.createElement("p",null,"Status:  ",this.displayStatus())))))}}]),e}(a.Component),j=Object(E.GoogleApiWrapper)({apiKey:"API_KEY"})(y),M=n(23),I=n(22),U=n.n(I),D=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(c.a)(this,Object(u.a)(e).call(this,t))).distance=function(t,e,n,a,o){if(t==n&&e==a)return 0;var r=Math.PI*t/180,s=Math.PI*n/180,l=e-a,i=Math.PI*l/180,c=Math.sin(r)*Math.sin(s)+Math.cos(r)*Math.cos(s)*Math.cos(i);return c>1&&(c=1),c=60*(c=180*(c=Math.acos(c))/Math.PI)*1.1515,"K"==o&&(c*=1.609344),"N"==o&&(c*=.8684),c},n.renderOnlineChildren=function(){return n.props.users.filter((function(t){return 1==t.status})).sort((function(t,e){return n.distance(t.latitude,t.longitude,48.305862,14.286444,"K").toFixed(2)-n.distance(e.latitude,e.longitude,48.305862,14.286444,"K").toFixed(2)})).map((function(t){return o.a.createElement(U.a,{transitionTime:"200",key:t.username,onOpen:function(){n.props.sendCoordinates(t.latitude,t.longitude)},onClose:function(){n.props.sendCoordinates(t.latitude,t.longitude)},trigger:"".concat(t.username," - \n\t\t\t\t\tDistance: ").concat(n.distance(t.latitude,t.longitude,48.305862,14.286444,"K").toFixed(2)," KM")},o.a.createElement("p",null,"Location:",o.a.createElement("br",null),"Latitude - ",t.latitude,o.a.createElement("br",null),"Longitude - ",t.longitude))}))},n.renderOfflineChildren=function(){return n.props.users.filter((function(t){return 0==t.status})).sort((function(t,e){return t.username.localeCompare(e.username)})).map((function(t){return o.a.createElement(U.a,{transitionTime:"200",key:t.username,onOpen:function(){n.props.sendCoordinates(t.latitude,t.longitude)},onClose:function(){n.props.sendCoordinates(t.latitude,t.longitude)},trigger:"".concat(t.username)},o.a.createElement("p",null,"Last seen at:",o.a.createElement("br",null),"Latitude - ",t.latitude,o.a.createElement("br",null),"Longitude - ",t.longitude))}))},n}return Object(d.a)(e,t),Object(i.a)(e,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement("h5",null,"Online Users"),o.a.createElement(M.a,null,this.renderOnlineChildren()),o.a.createElement("h5",null,"Offline Users"),o.a.createElement(M.a,null,this.renderOfflineChildren()))}}]),e}(o.a.Component),P=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(c.a)(this,Object(u.a)(e).call(this,t))).state={currentUser:localStorage.getItem("user"),currentLat:localStorage.getItem("lat"),currentLng:localStorage.getItem("lng"),panLat:localStorage.getItem("lat"),panLng:localStorage.getItem("lng"),users:[]},n.handleLogout=function(t){t.preventDefault(),m.a.post("http://localhost:3000/user/update/",{username:n.state.currentUser,longitude:n.state.currentLng,latitude:n.state.currentLat,status:"0"}).then((function(t){if("Update successful"==t.data&&(window.location="/",console.log("Logout Succesful")),"Update failed"==t.data)throw"Logout failed"})).catch((function(t){console.log(t),n.setState({error:"Logout failed"})})),localStorage.clear()},n.handleDelete=function(t){t.preventDefault(),m.a.delete("http://localhost:3000/user/"+n.state.currentUser).then((function(t){if("Deletion successful"!=t.data)throw"Deletion failed";window.location="/",console.log("Deletion successful")})).catch((function(t){console.log(t),n.setState({error:"Deletion failed"})})),localStorage.clear()},n.doSomethingBeforeUnload=function(){m.a.post("http://localhost:3000/user/update/",{username:n.state.currentUser,longitude:n.state.currentLng,latitude:n.state.currentLat,status:"0"}).then((function(t){if("Update successful"==t.data&&(window.location="/",console.log("Logout Succesful")),"Update failed"==t.data)throw"Logout failed"})).catch((function(t){console.log(t),n.setState({error:"Logout failed"})})),localStorage.clear()},n.setupBeforeUnloadListener=function(){window.addEventListener("beforeunload",(function(t){return t.preventDefault(),n.doSomethingBeforeUnload()}))},n.getCoordinates=n.getCoordinates.bind(Object(L.a)(n)),n}return Object(d.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.setupBeforeUnloadListener(),m.a.get("http://localhost:3000/user/").then((function(e){console.log(e.data),t.setState({users:e.data})})),this.interval=setInterval((function(){m.a.get("http://localhost:3000/user/").then((function(e){console.log(e.data),JSON.stringify(t.state.users)!==JSON.stringify(e.data)&&t.setState({users:e.data}),navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(e){e.coords.latitude==t.state.currentLat&&e.coords.longitude==t.state.currentLng||(m.a.post("http://localhost:3000/user/update/",{username:t.state.currentUser,longitude:e.coords.longitude,latitude:e.coords.latitude,status:"1"}).then((function(t){if("Update successful"==t.data&&console.log("Location Updated"),"Update failed"==t.data)throw"Location update failed"})).catch((function(e){console.log(e),t.setState({error:"Error during location update"})})),localStorage.setItem("lat",e.coords.latitude),localStorage.setItem("lng",e.coords.longitude),t.setState({currentLat:localStorage.getItem("lat"),currentLng:localStorage.getItem("lng")}))}))}))}),1e4)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval),this.handleLogout()}},{key:"getCoordinates",value:function(t,e){this.setState({panLat:t,panLng:e})}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement("h1",null,"Dynamic List"),o.a.createElement("h4",null,"Current User: ",localStorage.getItem("user")),o.a.createElement("button",{className:"button",style:{margin:20},type:"submit",onClick:this.handleLogout}," Logout"),o.a.createElement("button",{className:"button",style:{margin:20},type:"submit",onClick:this.handleDelete}," Delete Account"),o.a.createElement(b.a,null,o.a.createElement(D,{users:this.state.users,sendCoordinates:this.getCoordinates}),o.a.createElement(j,{users:this.state.users,panLat:this.state.panLat,panLng:this.state.panLng})))}}]),e}(o.a.Component),N=(n(79),n(80),function(t){function e(){return Object(l.a)(this,e),Object(c.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(i.a)(e,[{key:"render",value:function(){return o.a.createElement(p.a,null,o.a.createElement(g.c,null,o.a.createElement(g.a,{path:"/",exact:!0,component:f}),o.a.createElement(g.a,{path:"/map",exact:!0,component:P})))}}]),e}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[40,1,2]]]);
//# sourceMappingURL=main.e74e35fa.chunk.js.map